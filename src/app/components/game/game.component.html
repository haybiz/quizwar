<div class="game-container">
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="player-stats">
            <span class="score-pill">üèÖ {{ currentPlayerData().score || 0 }} pts</span>
            @if ((currentPlayerData().streak || 0) >= 3) {
            <span class="streak-pill">üî• x{{ currentPlayerData().streak }} Streak (1.5x)</span>
            }
        </div>
        <div class="timer" [class]="getTimerClass()">
            <span class="timer-icon">‚è±Ô∏è</span>
            <span class="timer-value">{{ timeRemaining() }}</span>
        </div>
    </div>

    <!-- Timer Bar -->
    <div class="timer-bar-wrapper">
        <div class="timer-bar" [class]="getTimerClass()" [style.width.%]="getTimerWidth()"></div>
    </div>

    <div class="game-layout">
        <!-- Main Game Area -->
        <div class="main-area">
            @if (room()?.status === 'countdown') {
            <!-- COUNTDOWN SCREEN -->
            <div class="countdown-screen">
                <h2 class="countdown-title">Get Ready!</h2>
                <div class="countdown-number">{{ countdownRemaining() || 1 }}</div>
                <p class="countdown-subtitle">Battle starting soon...</p>
            </div>
            } @else if (currentQuestion(); as q) {
            <!-- GAMEPLAY SCREEN -->
            <div class="header">
                <div class="question-counter">
                    Question {{ currentQuestionNum() }} / {{ totalQuestions() }}
                </div>
                <div class="question-category">
                    {{ q.category }}
                </div>
            </div>

            <div class="question-card">
                <p class="question-text">{{ q.question }}</p>
            </div>

            <div class="answers-grid">
                @for (answer of q.answers; track $index) {
                <button class="answer-btn {{ getAnswerClass(answer) }}"
                    [disabled]="hasAnswered() || timeRemaining() <= 0" (click)="selectAnswer(answer)">
                    <span class="answer-label">{{ getAnswerLabel($index) }}</span>
                    <span class="answer-text">{{ answer }}</span>
                </button>
                }
            </div>

            @if (hasAnswered() && !showingResults()) {
            <div class="feedback locked-in">
                üîí Answer locked in! Waiting for other players...
            </div>
            }

            @if (showingResults()) {
            <div class="feedback results-shown">
                @if (currentPlayerData().isCorrect === true) {
                ‚úÖ Correct!
                @if (isFastest(currentPlayerId())) {
                <span class="fastest-badge">‚ö° Fastest!</span>
                }
                @if ((currentPlayerData().streak || 0) >= 3) {
                <span class="streak-badge">üî• Streak x{{ currentPlayerData().streak }}!</span>
                }
                } @else if (selectedAnswer()) {
                ‚ùå Wrong answer
                } @else {
                ‚è∞ Time's up!
                }
                <span class="next-hint">Next question coming up...</span>
            </div>
            }
            } @else {
            <div class="loading-question">
                <div class="spinner-lg"></div>
                <p>Loading question...</p>
            </div>
            }
        </div>
    </div>

    <!-- Live Emotes Overlay -->
    <div class="emotes-overlay">
        @for (player of playersArray(); track player.id) {
        @if (player.activeEmote) {
        <div class="floating-emote" [style.left.%]="getEmotePosition(player.id)">
            <span class="emote-bubble">{{ player.activeEmote }}</span>
            <span class="emote-avatar">{{ player.avatar || 'üòé' }}</span>
        </div>
        }
        }
    </div>

    <!-- Player Emote Bar -->
    <div class="emote-dock">
        @for (emote of availableEmotes; track emote) {
        <button class="emote-btn" (click)="sendEmote(emote)">{{ emote }}</button>
        }
    </div>
</div>